#!/usr/bin/env fish

function is_starting
    set response (rdctl api -X GET /v1/backend_state 2>/dev/null)
    if test -z "$response"
        return
    end

    set starting (echo $response | yq -p=json '.vmState == "STARTING"')
    if test "$starting" != "true"
        return 1
    end
end
while is_starting
    echo -ne "\rEngine is starting..."
    pgrep "Rancher Desktop" >/dev/null || open -a "Rancher Desktop" --background
    sleep 0.3
end
