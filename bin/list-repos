#!/usr/bin/env python3.13
# pyright: strict
import sys
from pathlib import Path
from typing import Iterable

IGNORED_DIRS = ["node_modules", ".venv"]


def path_should_be_scanned(path: Path) -> bool:
    return path.is_dir() and not any(
        path.name == one_ignored_directory for one_ignored_directory in IGNORED_DIRS
    )


def iter_git_repos(path: Path) -> Iterable[Path]:
    if not path_should_be_scanned(path):
        return

    for child_path in path.glob("*"):
        if not path_should_be_scanned(child_path):
            continue
        if (child_path / ".git").is_dir():
            yield child_path
        for grand_child_path in child_path.glob("*"):
            yield from iter_git_repos(grand_child_path)


root_path = Path(sys.argv[1] if len(sys.argv) > 1 else ".")
for child_path in iter_git_repos(root_path):
    print(child_path, flush=True)
