#!/usr/bin/env python3.13
# pyright: strict
import sys
from pathlib import Path
from typing import Iterable

IGNORED_DIRS = [
    "__pycache__",
    ".git",
    ".hypothesis",
    ".mypy_cache",
    ".pytest_cache",
    ".ruff_cache",
    ".venv",
    "node_modules",
]


def path_should_be_scanned(path: Path) -> bool:
    return path.is_dir() and not any(
        path.name == one_ignored_directory for one_ignored_directory in IGNORED_DIRS
    )


def is_git_dir(path: Path) -> bool:
    return (path / ".git").is_dir()


def iter_git_repos(path: Path) -> Iterable[Path]:
    if not path_should_be_scanned(path):
        return
    if is_git_dir(path):
        yield path

    for child_path in path.glob("*"):
        if not path_should_be_scanned(child_path):
            continue
        if is_git_dir(child_path):
            yield child_path
        for grand_child_path in child_path.glob("*"):
            yield from iter_git_repos(grand_child_path)


root_path = Path(sys.argv[1] if len(sys.argv) > 1 else ".")
for child_path in iter_git_repos(root_path):
    print(child_path, flush=True)
